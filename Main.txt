
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <time.h>

// Estruturas
typedef struct {
    char nome[50];
    int energia;
    int local;
    int objeto;
    int tesouro;
} Jogador;

typedef struct {
    int norte, sul, este, oeste, cima, baixo;
    char descricao[200];
    int objeto;
    int tesouro;
} Sala;

typedef struct {
    char nome[50];
    int eficacia;
} Objeto;

typedef struct {
    int energia;
    int local;
} Monstro;

// Variáveis globais
Jogador jogador;
Sala *mapa;
Objeto *objetos;
Monstro monstro;
int nSalas = 0;
int nObjetos = 0;

// Protótipos de funções
void inicializarJogador();
void inicializarMapa();
void inicializarObjetos();
void inicializarMonstro();
void descreverLocal(int local);
void moverJogador(char comando);
void moverMonstro();
void lutar();
int verificarFimDeJogo();

int main(int argc, char *argv[]) {
    // Modo Super User
    if (argc > 1 && strcmp(argv[1], "1234") == 0) {
        jogador.energia = atoi(argv[2]);
        jogador.local = atoi(argv[3]);
        jogador.objeto = atoi(argv[4]);
    } else {
        inicializarJogador();
    }

    inicializarMapa();
    inicializarObjetos();
    inicializarMonstro();

    char comando;
    int fimDeJogo = 0;

    while (!fimDeJogo) {
        moverMonstro();
        descreverLocal(jogador.local);
        printf("Comando (N/S/E/O/C/B): ");
        scanf(" %c", &comando);
        moverJogador(comando);

        if (jogador.local == monstro.local) {
            lutar();
        }

        fimDeJogo = verificarFimDeJogo();
    }

    printf("Fim de jogo!\n");
    return 0;
}

void inicializarJogador() {
    strcpy(jogador.nome, "Aventureiro");
    jogador.energia = 100;
    jogador.local = 0;
    jogador.objeto = -1;
    jogador.tesouro = -1;
}

void inicializarMapa() {
    nSalas = 2;
    mapa = malloc(nSalas * sizeof(Sala));

    // Sala 0
    mapa[0].norte = -1;
    mapa[0].sul = -1;
    mapa[0].este = 1;
    mapa[0].oeste = -1;
    mapa[0].cima = -1;
    mapa[0].baixo = -1;
    mapa[0].objeto = -1;
    mapa[0].tesouro = -1;
    strcpy(mapa[0].descricao, "Tarnished... Please leave this room... your are not allowed here, in ground zero...");

    // Sala 1
    mapa[1].norte = -1;
    mapa[1].sul = -2;
    mapa[1].este = 0;
    mapa[1].oeste = 3;
    mapa[1].cima = -1;
    mapa[1].baixo = -1;
    mapa[1].objeto = -1;
    mapa[1].tesouro = -1;
    strcpy(mapa[1].descricao, "The room is dark... search for some light...");
}

void inicializarObjetos() {
    nObjetos = 1;
    objetos = malloc(nObjetos * sizeof(Objeto));
    strcpy(objetos[0].nome, "Espada");
    objetos[0].eficacia = 20;
}

void inicializarMonstro() {
    monstro.energia = 50;
    monstro.local = 1;
}

void descreverLocal(int local) {
    if (local >= 0 && local < nSalas) {
        printf("%s\n", mapa[local].descricao);
    }
}

void moverJogador(char comando) {
    int destino = -1;
    switch (comando) {
        case 'N': destino = mapa[jogador.local].norte; break;
        case 'S': destino = mapa[jogador.local].sul; break;
        case 'E': destino = mapa[jogador.local].este; break;
        case 'O': destino = mapa[jogador.local].oeste; break;
        case 'C': destino = mapa[jogador.local].cima; break;
        case 'B': destino = mapa[jogador.local].baixo; break;
        default: printf("Comando inválido.\n"); return;
    }

    if (destino == -1) {
        printf("Não podes ir nessa direção.\n");
    } else {
        jogador.local = destino;
    }
}

void moverMonstro() {
    // Movimento aleatório simples
    int direcao = rand() % 6;
    int destino = -1;

    switch (direcao) {
        case 0: destino = mapa[monstro.local].norte; break;
        case 1: destino = mapa[monstro.local].sul; break;
        case 2: destino = mapa[monstro.local].este; break;
        case 3: destino = mapa[monstro.local].oeste; break;
        case 4: destino = mapa[monstro.local].cima; break;
        case 5: destino = mapa[monstro.local].baixo; break;
    }

    if (destino != -1) {
        monstro.local = destino;
    }
}

void lutar() {
    printf("Encontraste o monstro! Luta começou...\n");
    // Lógica de luta simples
    while (jogador.energia > 0 && monstro.energia > 0) {
        int danoJogador = (jogador.objeto != -1) ? objetos[jogador.objeto].eficacia : 10;
        monstro.energia -= danoJogador;
        printf("Atacaste o monstro! Energia do monstro: %d\n", monstro.energia);

        if (monstro.energia > 0) {
            jogador.energia -= 10;
            printf("O monstro atacou-te! Energia: %d\n", jogador.energia);
        }
    }

    if (monstro.energia <= 0) {
        printf("Derrotaste o monstro!\n");
        monstro.local = -1; // Monstro morreu
    }
}

int verificarFimDeJogo() {
    return jogador.energia <= 0 || (jogador.tesouro == 1 && monstro.energia <= 0);
}